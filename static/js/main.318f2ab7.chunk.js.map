{"version":3,"sources":["components/ExternalLink.js","utils/nameCleaner.js","utils/firstTag.js","components/Schedule.js","App.js","index.js"],"names":["props","className","href","to","target","newTab","rel","children","string","toLowerCase","replace","elem","tag","Array","from","getElementsByTagName","Schedule","init","a","loadDates","parseSpekts","tryFindImgs","axios","get","months","data","currentMonth","Object","keys","dates","performances","_","forOwn","date","dateName","forEach","performance","dateParts","PerfDate","split","time","push","values","map","setState","state","spekts","slice","hasOwnProperty","Name","lastPerfomance","length","tryFindImgsInterval","setInterval","blogPosts","document","getElementsByClassName","tryCount","console","log","clearInterval","undefined","post","firstTag","name","innerText","img","src","additionalData","nameCleaner","renderHeadline","ExternalLink","month","format","Date","locale","ru","renderItem","item","type","times","reduce","b","BuildingName","HallName","openBracketIndex","indexOf","closeBracketIndex","id","IdPerformance","renderSpekts","spekt","renderPerformances","render","React","Component","App","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.318f2ab7.chunk.js","sourcesContent":["import React from 'react'\n\nexport default (props) => (\n  <a\n    className={props.className}\n    href={props.to}\n    target={props.newTab ? \"_blank\" : \"\"}\n    rel=\"noopener noreferrer\"\n  >\n    {props.children}\n  </a>\n)","export default string =>\n  string && string\n    .toLowerCase()\n    .replace(/ё/g, 'е')\n    .replace(/[^а-я]/g, '')\n","export default (elem, tag) =>\n  Array.from(\n    elem.getElementsByTagName(tag)\n  )[0]","import React from 'react'\n\nimport { format } from 'date-fns'\nimport { ru } from 'date-fns/locale'\nimport axios from 'axios'\nimport _ from 'lodash'\n\nimport ExternalLink from './ExternalLink'\nimport nameCleaner from '../utils/nameCleaner'\nimport firstTag from '../utils/firstTag'\n\n\nexport default class Schedule extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      dates: {},\n      spekts: {},\n      performances: [],\n      additionalData: {},\n      tryCount: 0,\n    }\n\n    this.init()\n  }\n\n  init = async () => {\n    await this.loadDates()\n    this.parseSpekts()\n    this.tryFindImgs()\n  }\n\n  loadDates = async () => {\n    const months = (await axios\n      .get('https://apit.bileter.ru/8e665805311706860c2ef141d3dc13e2/afisha?json=1'))\n      .data\n    const currentMonth = months[Object.keys(months)[0]]\n    let dates = {}, performances = []\n\n    _.forOwn(currentMonth, (date, dateName) => {\n      date.forEach(performance => {\n        const dateParts = performance.PerfDate.split(' ')[0].split('.')\n        const time = performance.PerfDate.split(' ')[1]//.slice(0, -3)\n        const PerfDate = `${dateParts[1]}/${dateParts[0]}/${dateParts[2]} ${time}`\n\n        if(!dates[dateName])\n          dates[dateName] = []\n\n        dates[dateName].push({\n          ...performance,\n          PerfDate: PerfDate,\n        })\n      })\n    })\n\n    _.values(dates)\n      .map(date =>\n        date\n          .map(performance =>\n            performances.push(performance)))\n\n    this.setState({\n      dates: dates,\n      performances: performances,\n    })\n  }\n\n  parseSpekts = () => {\n    const { dates } = this.state\n    let spekts = {}\n\n    _.forOwn(dates, date => \n      _.forOwn(date, performance => {\n        const date = performance.PerfDate.split(' ')[0]\n        const time = performance.PerfDate.split(' ')[1].slice(0, 5)\n\n        if (spekts.hasOwnProperty(performance.Name)) {\n          const lastPerfomance = spekts[performance.Name][spekts[performance.Name].length - 1]\n\n          if (lastPerfomance.PerfDate === date)\n            lastPerfomance.time.push(time)\n          else\n            spekts[performance.Name].push({\n              ...performance,\n              PerfDate: date,\n              time: [time]\n            })\n        } else\n          spekts[performance.Name] = [{\n            ...performance,\n            PerfDate: date,\n            time: [time]\n          }]\n      })\n    )\n\n    this.setState({spekts: spekts})\n  }\n\n  tryFindImgs = () => {\n    if (!this.tryFindImgsInterval)\n      this.tryFindImgsInterval = setInterval(this.tryFindImgs, 100)\n\n    const blogPosts = document.getElementsByClassName('category-performance')\n    const { tryCount } = this.state\n\n    if (tryCount > 100) {\n      console.log(`imgs wasn't found after ${tryCount} tries`)\n      clearInterval(this.tryFindImgsInterval)\n      this.tryFindImgsInterval = undefined\n      return\n    }\n\n    if (blogPosts.length === 0) {\n      this.setState({tryCount: tryCount + 1})\n      return\n    }\n\n    console.log(`imgs found after ${tryCount} tries`)\n    clearInterval(this.tryFindImgsInterval)\n    this.tryFindImgsInterval = undefined\n\n    Array.from(blogPosts).forEach(post => {\n      const to = firstTag(firstTag(post, 'h2'), 'a').href\n      const name = firstTag(firstTag(post, 'h2'), 'a').innerText\n      const img = firstTag(post, 'img').src\n\n      this.setState({additionalData: {\n        ...this.state.additionalData,\n        [nameCleaner(name)]: {\n          img: img,\n          to: to,\n        }\n      }})\n    })\n  }\n\n  renderHeadline = () => \n    <h2 className=\"cmsmasters_heading\">\n      Смотрите в <ExternalLink to=\"https://nebdt.ru/afisha/\">\n        {(() => {\n          const month = format(new Date(), \"MMMM\", { locale: ru })\n\n          return month.slice(-1) === 'т' ? month : month.slice(0, -1) + 'е'\n        })()}\n      </ExternalLink>\n    </h2>\n\n  renderItem = (item, type) =>\n    <div\n      key={item.IdPerformance}\n      className=\"lev-schedule__spekt\"\n    >\n      <ExternalLink\n        className=\"lev-schedule__spekt__to\"\n        to={this.state.additionalData[nameCleaner(item.Name)]?.to}\n      >\n        <img\n          className=\"lev-schedule__spekt__to__img\"\n          src={this.state.additionalData[nameCleaner(item.Name)]?.img || \"\"}\n        />\n        <div className=\"lev-schedule__spekt__to__name\">\n          {item.Name}\n        </div>\n        <div className=\"lev-schedule__spekt__to__dates\">\n          {type === \"spekt\" ?\n            item\n              .map(performance => {\n                const date = new Date(performance.PerfDate)\n                const times = performance.time\n                  .reduce((a, b) => a + ', ' + b)\n                  .replace(/\\,(?!.*\\,)/, ' и')\n\n                return format(date, `dd, iiii, ${times}`, { locale: ru })\n              })\n              .reduce((a, b) => a + ' / ' + b)\n            :\n            format(new Date(item.PerfDate), `dd, iiii, HH:mm`, { locale: ru })\n          } / {(() => {\n            const { BuildingName, HallName } = type === \"spekt\" ? item[0] : item\n            const openBracketIndex = BuildingName.indexOf('(')\n            const closeBracketIndex = BuildingName.indexOf(')')\n\n            return openBracketIndex !== -1 && closeBracketIndex !== -1 ?\n              BuildingName.slice(openBracketIndex + 1, closeBracketIndex)\n              :\n              HallName\n          })()}\n        </div>\n      </ExternalLink>\n      {type !== \"spekt\" &&\n        <div\n          className=\"lev-schedule__spekt__button with_buy bileter_afisha_showhall\"\n          id={`perf${item.IdPerformance}`}\n        >\n          Купить билет\n        </div>\n      }\n    </div>\n\n  renderSpekts = () =>\n    Object.keys(this.state.spekts) &&\n      _.values(this.state.spekts)\n        .map(spekt =>\n          this.renderItem(spekt, \"spekt\"))\n\n  renderPerformances = () =>\n    this.state.performances\n      .slice(0, 6)\n        .map(performance =>\n          this.renderItem(performance))\n\n  render = () =>\n    <>\n      {this.renderHeadline()}\n      <div className=\"lev-schedule\">\n        {/* {this.renderSpekts()} */}\n        {this.renderPerformances()}\n      </div>\n    </>\n}","import React, { Component } from 'react'\n\nimport Schedule from './components/Schedule'\n\n\nexport default class App extends Component {\n  render = () => (\n    <>\n      <div id=\"react-injected-div\" />\n      <Schedule />\n    </>\n  )\n}","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nimport './styles/index.sass'\n\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n)"],"sourceRoot":""}